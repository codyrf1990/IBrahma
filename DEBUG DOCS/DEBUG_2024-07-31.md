# SolidCAM Sub Tracker Debugging Information

## 1. Application State (`src/js/state.js`)

This object holds the core runtime state of the application.

```javascript
// Default/Initial State Definition
export const state = {
    currentView: 'all', // Default view ('all' or 'confirmed')
    totals: {}, // Object storing monthly subtotals (populated at runtime)
    receiptsGoal: 55, // Target number of confirmed receipts (can be updated)
    totalPool: 452, // Total potential accounts/receipts (can be updated)
    checkedRows: [], // Array storing the IDs of checked rows (e.g., ['row1', 'row3'])
    lastSaved: null, // Timestamp of the last successful save
    editingRowId: null // ID of the row currently being edited in the modal
};
```

*(Note: Actual runtime values might differ from defaults)*

## 2. Saved Data Structure (Example from `License-Tracker-Data.md`)

This shows the structure of data saved to `localStorage` or the `.md` file. The `html` field within `sections` seems large and might contain escaped HTML for rows.

```json
{
  "rowCount": 13,
  "currentView": "checked",
  "totals": {
    "january": 0, "february": 0, "march": 12271, "april": 28093,
    "may": 0, "june": 0, "july": 0, "august": 0,
    "september": 0, "october": 0, "november": 0, "december": 0
  },
  "checkedTotals": {
    "january": 0, "february": 0, "march": 12271, "april": 6027,
    "may": 0, "june": 0, "july": 0, "august": 0,
    "september": 0, "october": 0, "november": 0, "december": 0
  },
  "uncheckedTotals": {
    "january": 0, "february": 0, "march": 0, "april": 22066,
    "may": 0, "june": 0, "july": 0, "august": 0,
    "september": 0, "october": 0, "november": 0, "december": 0
  },
  "sections": [
    {
      "month": "march",
      "html": "<div class=\"client-row checked\" id=\"row1\">...</div>..." // Contains escaped HTML for rows in this month
    },
    {
      "month": "april",
      "html": "<div class=\"client-row\" id=\"row5\">...</div>..." // Contains escaped HTML for rows in this month
    }
    // ... other months
  ],
  "checkedRows": ["row1", "row2", "row3", "row4", "row10", "row11", "row12"],
  "lastSaved": "2025-04-24T18:24:17.630Z",
  "version": "2.0" // Note: Version field exists
}
```
*(Note: The actual saved structure in `localStorage` managed by `data.js` might differ slightly, potentially omitting the HTML field and using a `licenses` array instead)*

## 3. Core Logic Entry Point (`src/js/main.js`)

Key initialization and event binding happen here.

```javascript
// Initialization Sequence (Inside DOMContentLoaded listener)
loadInitialData(); // Loads from localStorage or initializes empty state
setupEventListeners(); // Attaches listeners to buttons, inputs, etc.
setInterval(saveData, 30000); // Auto-saves every 30 seconds
setupObsidianCallbackHandler(); // Sets up handler for sfbuddy:// URLs

// Key Event Handlers Bound (Examples)
// - Export/Import buttons -> saveToObsidian / loadFromObsidian
// - Add Renewal button -> addLicense (eventHandlers.js)
// - View Toggle buttons -> toggleView (domUtils.js)
// - Checkboxes (delegated) -> toggleChecked (eventHandlers.js)
// - Delete icons (delegated) -> deleteRow (eventHandlers.js)
// - Edit icons (delegated) -> openEditModal (domUtils.js)
// - Edit Modal Save -> saveEditChanges (eventHandlers.js)
```

## 4. Data Handling (`src/js/data.js`)

Responsible for loading, saving, parsing, and validating data.

```javascript
// Key Functions
saveData() // Reads DOM, constructs license objects, saves state + licenses to localStorage
loadInitialData() // Loads from localStorage, calls validateAndImport
saveToObsidian() // Constructs obsidian://advanced-uri URL to write data
loadFromObsidian() // Constructs obsidian://advanced-uri URL to read data, waits for sfbuddy:// callback
validateAndImport(jsonData) // Parses JSON, validates structure, clears UI, rebuilds UI from data, recalculates totals
```

## 5. HTML Structure (`index.html` - Snippets)

Relevant IDs and classes used by the JavaScript.

```html
<!-- Main container for month sections -->
<div class="container" id="main-container">
    <!-- Dynamically added month sections like: -->
    <!-- <div class="month-section" id="month-april"> ... <tr class="client-row" id="rowX"> ... </div> -->
</div>

<!-- Add new renewal form inputs -->
<input type="text" id="account-name">
<input type="date" id="close-date">
<input type="date" id="renewal-date">
<input type="number" id="amount">
<input type="text" id="opportunity-id">
<button class="add-btn">Add Renewal</button>

<!-- View Toggles -->
<button id="view-all-btn">View All</button>
<button id="view-confirmed-btn">View Confirmed</button>

<!-- Edit Modal -->
<div class="modal-overlay" id="edit-modal">
    <input type="text" id="edit-name">
    <input type="date" id="edit-date">
    <input type="date" id="edit-renewal-date">
    <input type="number" id="edit-amount">
    <input type="text" id="edit-opportunity-id">
    <input type="hidden" id="edit-row-id">
    <button class="add-btn">Save Changes</button>
</div>

<!-- Progress/Goal Inputs -->
<input type="number" id="receipts-goal-input">
<input type="number" id="total-pool-input">

<!-- Auto-save Indicator -->
<div id="auto-save-indicator"></div>
```

## 6. Dependencies

- Relies heavily on DOM structure defined in `index.html`.
- Uses `localStorage` for primary persistence.
- Interacts with Obsidian via `obsidian://advanced-uri` and a custom `sfbuddy://` protocol handler.
- JavaScript modules: `state.js`, `utils.js`, `data.js`, `domUtils.js`, `eventHandlers.js`. 