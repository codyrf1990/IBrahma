<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iBrahma - Opp Tracker</title>
    <link rel="icon" type="image/png" href="src/assets/Images/scfav.png" sizes="48x41">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div id="license-app">
        <!-- NEW HEADER STRUCTURE -->
        <header class="main-header">
            <div class="title-group" id="appLogoArea">
                <h1 class="app-title">iBramah</h1>
                <p class="app-tagline">Opportunity Tracker</p>
            </div>
            <img src="src/assets/Images/SolidCAM.png" alt="SolidCAM Logo" class="header-logo">
            <div class="percentage-calculator summary-box"> <!-- Moved content here -->
                <h4>Quick % Calc</h4>
                <div class="calculator-content"> <!-- ADDED WRAPPER -->
                    <div class="calc-input-row">
                        <label for="calculator-amount">Amount:</label>
                        <input type="number" id="calculator-amount" placeholder="e.g., 1000">
                    </div>
                    <div class="calculator-results">
                        <div id="result-container-5" class="percentage-result-item"></div>
                        <div id="result-container-10" class="percentage-result-item"></div>
                        <div id="result-container-15" class="percentage-result-item"></div>
                    </div>
                </div> <!-- END ADDED WRAPPER -->
            </div>
        </header>

        <!-- COMMANDER CARD START -->
        <div id="commander-card" class="card">

            <div id="commander-system-section" class="commander-section">
                <h3>System</h3>
                <div class="icon-grid">
                    <div class="commander-icon" id="icon-save-to-file" title="Save to File"><img src="src/assets/Images/save Best.png" alt="Save" style="width: 40px; height: 40px;"><span class="icon-label">Save</span></div>
                    <div class="commander-icon" id="icon-load-from-file" title="Load from File"><img src="src/assets/Images/load data 2.png" alt="Load" style="width: 40px; height: 40px;"><span class="icon-label">Load</span></div>
                    <div class="commander-icon" id="icon-add-renewal" title="Add Renewal"><img src="src/assets/Images/Add Account.png" alt="Add" style="width: 40px; height: 40px;"><span class="icon-label">Add</span></div>
                    <div class="commander-icon" id="icon-system-help" title="Help"><img src="src/assets/Images/help.png" alt="Help" style="width: 40px; height: 40px;"><span class="icon-label">Help</span></div>
                </div>
            </div>
            <div id="commander-chats-section" class="commander-section">
                <h3>AI Chats</h3>
                <button id="btn-chat-std" class="button medium-button">SolidCAM Chat Std</button>
            </div>
            <div id="commander-utils-section" class="commander-section">
                <h3>Utilities</h3>
                <div class="icon-grid">
                    <div class="commander-icon" id="icon-app-suggestions" title="App Suggestions">
                        <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <img src="src/assets/Images/idea.png" alt="App Suggestions" style="width: 40px; height: 40px;">
                        </div>
                        <span class="icon-label">App Suggestions</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- COMMANDER CARD END -->

        <!-- Hidden file input (moved outside buttons) -->
        <input type="file" id="file-input" accept=".json" style="display: none;">
        <span class="sync-message" id="sync-message" role="status" style="display: block; text-align: center; margin-bottom: 10px;"></span>

        <!-- Add New Renewal Section (Modal) -->
        <div id="add-renewal-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="add-section" id="add-section">
                    <h3>Add New Renewal <span id="add-renewal-year-indicator"></span></h3>
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="account-name">Account Name</label>
                            <input type="text" id="account-name" required placeholder="Enter account name">
                        </div>
                        <div class="form-field">
                            <label for="renewal-date">Renewal Date</label>
                            <input type="date" id="renewal-date">
                        </div>
                        <div class="form-field">
                            <label for="amount">Amount USD</label>
                            <input type="number" id="amount" required min="0" step="0.01" placeholder="Enter amount">
                        </div>
                        <div class="form-field">
                            <label for="opportunity-id">Opportunity ID</label>
                            <input type="text" id="opportunity-id" required placeholder="Enter Opportunity ID">
                        </div>
                    </div>
                    <div class="button-row">
                        <button class="cancel-btn">Cancel</button>
                        <button class="add-btn">Add Renewal</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmed Receipts / Progress Area (Refactored) -->
        <!-- ORIGINAL CONTAINER REMOVED AS IT'S NOW EMPTY -->
        <!-- <div class="receipts-progress"> -->
             <!-- Existing: Percentage Calculator (Class added) -->
             <!-- MOVED TO HEADER -->
        <!-- </div> -->

        <!-- YEAR TABS START -->
        <div id="year-tabs-container" class="card">
            <div class="year-tabs-header">
                <h3>Year Selection</h3>
                <button id="add-year-btn" class="button small-button" title="Add New Year">
                    <i class="fas fa-plus"></i> Add Year
                </button>
            </div>
            <div id="year-tabs" class="year-tabs">
                <!-- Year buttons will be dynamically inserted here -->
            </div>
        </div>
        <!-- YEAR TABS END -->

        <!-- Totals Toggle and Confirmed Total Area (Refactored) -->
        <div class="totals-summary">
             <!-- NEW: Combined Progress Overview Box -->
             <div id="progress-overview" class="summary-box">
                 <h3>Progress Overview</h3>
                 <!-- Main Info Texts -->
                 <p id="receipts-info">0 of 55 Confirmed Deals</p> <!-- Renamed from div -->
                 <div class="progress-bar-container" style="margin-bottom: 0.75rem;"> <!-- Added wrapper & margin -->
                     <div class="progress-bar">
                         <div class="progress-fill" id="receipts-progress" style="width: 0%"></div>
                     </div>
                 </div>
                 <!-- Goal Control Group -->
                 <div class="control-group goal-group">
                     <span id="receipts-percentage">0%</span>
                     <input type="number" id="receipts-goal-input" value="55" min="1">
                     <button id="update-goal-btn">Total Accounts</button>
                 </div>
                 <hr> <!-- Separator -->
             </div>

             <!-- Renamed and Populated: Key Stats Section -->
             <div id="kpi-stats-section" class="summary-box summary-box-empty"> <!-- Renamed ID, kept classes -->
                 <h4>Key Stats</h4>
                 <div class="kpi-list">
                     <p>Total Pipeline Value: <span id="kpi-total-entered-amount" class="kpi-value">Calculating...</span></p>
                     <p>Average Deal Size: <span id="kpi-avg-amount" class="kpi-value">Calculating...</span></p>
                 </div>
             </div>

             <!-- NEW: Static text display for entry counts -->
             <!-- <p id="entry-summary-text" class="entry-summary">Loading counts...</p> -->
             <div id="total-confirmed-whole-card" class="summary-box entry-summary"> <!-- Replaced p with div and added class for styling -->
                 <h3>Total Revenue</h3>
                 <p id="total-confirmed-whole-value" class="kpi-value">$0</p> <!-- Added kpi-value class for consistency -->
             </div>
        </div>

        <!-- SEARCH BAR: Inserted above main container -->
        <div class="search-container" role="search">
          <label for="search-input" class="visually-hidden">Search Renewals:</label>
          <input type="search" id="search-input" placeholder="Search by Name or Opp ID...">
        </div>

        <!-- Main Container for Dynamic Month Sections (Moved) -->
        <div class="container" id="main-container">
            <!-- Month sections will be dynamically loaded here by script.js -->
            
            <!-- Placeholder for elements previously in totals-breakdown if needed -->
            <div id="legacy-totals-placeholder" style="display: none;">
                <div id="total-licenses"></div>
                <div id="total-value"></div>
                <div id="accounts-goal"></div>
                <div id="accounts-progress"></div>
                <div id="accounts-percentage"></div>
                <div id="accounts-ratio"></div>
                <div id="total-accounts-input"></div>
                <button></button> <!-- Keep JS function call available -->
            </div>

            <!-- Completion status -->
            <div class="completion-status" id="completion-message" style="display: none;">
                Congratulations! You've reached your account goal for this quarter.
            </div>
        </div>

        <!-- Edit Modal (Remains at end) -->
        <div class="modal-overlay" id="edit-modal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>Edit License</h3>
                    <button class="modal-close">Ã—</button>
                </div>
                <div class="modal-form">
                    <div class="form-field">
                        <label for="edit-name">Account Name</label>
                        <input type="text" id="edit-name" required>
                    </div>
                    <div class="form-field">
                        <label for="edit-renewal-date">Renewal Date</label>
                        <input type="date" id="edit-renewal-date">
                    </div>
                    <div class="form-field">
                        <label for="edit-amount">Amount (USD)</label>
                        <input type="number" id="edit-amount" required min="0" step="0.01">
                    </div>
                    <div class="form-field">
                        <label for="edit-opportunity-id">Opportunity ID</label> <!-- Changed from edit-id -->
                        <input type="text" id="edit-opportunity-id" required> <!-- Changed from edit-id -->
                    </div>
                    <input type="hidden" id="edit-row-id">
                </div>
                <div class="modal-actions">
                    <button class="cancel-btn">Cancel</button>
                    <button class="add-btn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmation-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>Confirm Action</h3>
                </div>
                <div class="modal-content">
                    <p id="modal-message"></p>
                </div>
                <div class="modal-footer">
                    <button id="modal-cancel-btn" class="cancel-btn">Cancel</button>
                    <button id="modal-confirm-btn" class="confirm-btn">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Auto-save indicator (Remains at end) -->
        <div id="auto-save-indicator">Changes saved</div>
    </div>

    <div id="logoHoverMessageWindow" class="fancy-message-window" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="logoHoverMessageTitle">
      <div class="fancy-message-content">
        <button id="closeLogoHoverMessage" class="close-btn" aria-label="Close message">&times;</button>
        <h2 id="logoHoverMessageTitle" class="visually-hidden">A special message</h2>
        <p>Like Henry Maudslay at Bramah's locks, every craftsman's journey begins with that first crucial innovation. From shop floors to breakthrough solutions, we honor those who taught us, the places that shaped us, and the constant pursuit of better ways. Here's to the mentors who saw potential, the challenges that forged skill, and the courage to seek new horizons while keeping old friendships.</p>
        <p class="message-signature">-From a machinist's journey: Shop floor to SolidCAM, every step builds the next</p>
      </div>
    </div>
    <div id="fancyMessageOverlay" style="display:none;"></div>

    <!-- MODAL FOR GENERIC CONTENT -->
    <div id="generic-content-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="generic-modal-close-btn" class="close-button">&times;</button>
            <h3 id="generic-modal-title">Generic Modal Title</h3>
            <div id="generic-modal-body">
                <iframe id="generic-modal-iframe" src="about:blank"></iframe>
            </div>
        </div>
    </div>


    <!-- App Suggestions Modal -->
    <div id="app-suggestion-modal-overlay" class="modal-overlay" style="display: none;">
        <div id="app-suggestion-modal">
            <div class="app-suggestion-modal-header">
                <h2 id="app-suggestion-modal-title"><i class="fas fa-lightbulb" aria-hidden="true"></i> Submit an App Suggestion</h2>
                <button id="app-suggestion-modal-close-btn" class="modal-close-button" aria-label="Close suggestion modal">&times;</button>
            </div>
            <form id="app-suggestion-form">
                <div class="app-suggestion-modal-body">
                    <div class="form-field">
                        <label for="suggestion-title">Suggestion Title</label>
                        <input type="text" id="suggestion-title" required placeholder="Brief title for your suggestion">
                    </div>
                    <div class="form-field">
                        <label for="suggestion-details">Details</label>
                        <textarea id="suggestion-details" rows="5" required placeholder="Describe your suggestion in detail..."></textarea>
                    </div>
                    <div class="form-field">
                        <label for="suggestion-priority">Priority</label>
                        <select id="suggestion-priority">
                            <option value="low">Low - Nice to have</option>
                            <option value="medium" selected>Medium - Would be helpful</option>
                            <option value="high">High - Important feature</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="suggestion-user-name">Your Name (Optional)</label>
                        <input type="text" id="suggestion-user-name" placeholder="Your name">
                    </div>
                </div>
                <div class="app-suggestion-modal-footer">
                    <button type="button" id="app-suggestion-cancel-btn" class="button secondary-button">Cancel</button>
                    <button type="submit" id="app-suggestion-send-btn" class="button primary-button">Send Suggestion</button>
                </div>
            </form>
        </div>
    </div>
    <!-- END App Suggestions Modal -->

    <script type="module" src="src/js/main.js"></script>
    <!-- Custom Help Modal Overlay -->
    <div id="custom-help-modal-overlay" class="modal-overlay" style="display: none;">
        <div id="custom-help-modal">
            <div class="custom-help-modal-header">
                <h2 id="custom-help-modal-title"><i class="fas fa-question-circle" aria-hidden="true"></i> Opportunity Tracker Help</h2>
                <button id="custom-help-modal-close-btn" class="modal-close-button" aria-label="Close help modal">&times;</button>
            </div>
            <div class="custom-help-modal-body">
                <section id="help-intro">
                    <h3>Introduction</h3>
                    <p>This guide provides a quick overview of the iBramah Opportunity Tracker features to help you get started.</p>
                </section>

                <section id="help-renewal-management">
                    <h3>Core Renewal Management</h3>
                    <p><strong>Adding Renewals:</strong> Click "Add Renewal" in the Commander Card. Fill in Account Name, Renewal Date, Sent Date, Close Date, Amount, and Opportunity ID, then click "Add Renewal".</p>
                    <p><strong>Editing Renewals:</strong> Click the <i class="fas fa-pencil-alt" aria-hidden="true"></i> (Edit) icon on a renewal row. Modify details and click "Save Changes".</p>
                    <p><strong>Deleting Renewals:</strong> Click the <i class="fas fa-trash-alt" aria-hidden="true"></i> (Delete) icon on a renewal row and confirm.</p>
                    <p><strong>Confirming Renewals:</strong> Check the box next to a renewal to mark it 'confirmed'. This updates progress and KPIs.</p>
                </section>

                <section id="help-data">
                    <h3>Data Management</h3>
                    <p><strong>Saving Data:</strong> Click the <i class="fas fa-save" aria-hidden="true"></i> (Save Data) icon in the Commander Card to download your data as a JSON file.</p>
                    <p><strong>Loading Data:</strong> Click the <i class="fas fa-folder-open" aria-hidden="true"></i> (Load Data) icon and select your saved JSON file.</p>
                    <p><strong>Auto-Save:</strong> Changes are automatically saved to your browser. Look for the "Changes saved" indicator.</p>
                </section>

                <section id="help-progress-kpi">
                    <h3>Progress & KPI Tracking</h3>
                    <p><strong>Progress Overview:</strong> Track confirmed renewals against your goal. Update your goal by entering a new value in the "Goal" input and clicking "Update Goal".</p>
                    <p><strong>Key Stats:</strong>
                        <ul>
                            <li><strong>Total Confirmed:</strong> Total value of confirmed renewals.</li>
                            <li><strong>Average Confirmed:</strong> Average value of confirmed renewals.</li>
                            <li><strong>Total Entered:</strong> Total value of all entered renewals (refer to <code>#kpi-total-confirmed</code> for the specific element, or clarify if another element represents this).</li>
                        </ul>
                    </p>
                </section>

                <section id="help-commander-card">
                    <h3>Commander Card Quick Actions</h3>
                    <p><strong>System:</strong> <i class="fas fa-save" aria-hidden="true"></i> Save, <i class="fas fa-folder-open" aria-hidden="true"></i> Load, <i class="fas fa-plus-circle" aria-hidden="true"></i> Add Renewal, <i class="fas fa-question-circle" aria-hidden="true"></i> Help (this window).</p>
                    <p><strong>AI Chats:</strong> Launch "SolidCAM Chat Std" or "SolidCAM Chat Pro" (in a sidebar).</p>
                    <p><strong>Utilities:</strong> Access <i class="fas fa-envelope" aria-hidden="true"></i> Email, <i class="fas fa-calculator" aria-hidden="true"></i> Calculator, <i class="fas fa-sticky-note" aria-hidden="true"></i> Notes.</p>
                </section>

                <section id="help-search">
                    <h3>Finding Renewals</h3>
                    <p>Use the Search Bar (above the main list, placeholder "Search by Name or Opp ID...") to quickly filter renewals.</p>
                </section>

                <section id="help-quick-calc">
                    <h3>Quick Percentage Calculator</h3>
                    <p>Located in the header. Enter an 'Amount' in the 'Quick % Calc' field to see 5%, 10%, and 15% calculated instantly in the adjacent result areas.</p>
                </section>
            </div>
            <div class="custom-help-modal-footer">
                <p>iBramah Opportunity Tracker - Version 1.0.0</p>
            </div>
        </div>
    </div>
</body>
</html>