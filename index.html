<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iBrahma - Opp Tracker</title>
    <link rel="icon" type="image/png" href="src/assets/Images/scfav.png" sizes="48x41">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div id="license-app">
        <!-- NEW HEADER STRUCTURE -->
        <header class="main-header">
            <div class="title-group" id="appLogoArea">
                <h1 class="app-title">iBramah</h1>
                <p class="app-tagline">Opportunity Tracker</p>
            </div>
            <img src="src/assets/Images/SolidCAM.png" alt="SolidCAM Logo" class="header-logo">
            <div class="percentage-calculator summary-box"> <!-- Moved content here -->
                <h4>Quick % Calc</h4>
                <div class="calculator-content"> <!-- ADDED WRAPPER -->
                    <div class="calc-input-row">
                        <label for="calculator-amount">Amount:</label>
                        <input type="number" id="calculator-amount" placeholder="e.g., 1000">
                    </div>
                    <div class="calculator-results">
                        <div id="result-container-5" class="percentage-result-item"></div>
                        <div id="result-container-10" class="percentage-result-item"></div>
                        <div id="result-container-15" class="percentage-result-item"></div>
                    </div>
                </div> <!-- END ADDED WRAPPER -->
            </div>
        </header>

        <!-- COMMANDER CARD START -->
        <div id="commander-card" class="card">
            <div id="settings-icon-container">
                <i class="fas fa-cog" id="settings-cog-icon" title="Settings"></i>
            </div>
            <div id="commander-system-section" class="commander-section">
                <h3>System</h3>
                <div class="icon-grid">
                    <div class="commander-icon" id="icon-save-to-file" title="Save to File"><img src="src/assets/Images/save Best.png" alt="Save" style="width: 40px; height: 40px;"><span class="icon-label">Save</span></div>
                    <div class="commander-icon" id="icon-load-from-file" title="Load from File"><img src="src/assets/Images/load data 2.png" alt="Load" style="width: 40px; height: 40px;"><span class="icon-label">Load</span></div>
                    <div class="commander-icon" id="icon-add-renewal" title="Add Renewal"><img src="src/assets/Images/Add Account.png" alt="Add" style="width: 40px; height: 40px;"><span class="icon-label">Add</span></div>
                    <div class="commander-icon" id="icon-system-settings" title="Settings"><img src="src/assets/Images/settings12.png" alt="Settings" style="width: 40px; height: 40px;"><span class="icon-label">Settings</span></div>
                    <div class="commander-icon" id="icon-user-profile" title="User Profile"><img src="src/assets/Images/Profile.png" alt="Profile" style="width: 40px; height: 40px;"><span class="icon-label">Profile</span></div>
                    <div class="commander-icon" id="icon-system-help" title="Help"><img src="src/assets/Images/help.png" alt="Help" style="width: 40px; height: 40px;"><span class="icon-label">Help</span></div>
                </div>
            </div>
            <div id="commander-chats-section" class="commander-section">
                <h3>AI Chats</h3>
                <button id="btn-chat-std" class="button medium-button">SolidCAM Chat Std</button>
                <button id="btn-chat-pro" class="button medium-button">SolidCAM Chat Pro</button>
            </div>
            <div id="commander-utils-section" class="commander-section">
                <h3>Utilities</h3>
                <div class="icon-grid">
                    <div class="commander-icon" id="icon-email-templates" title="Email Templates"><img src="src/assets/Images/emails 1.png" alt="Email" style="width: 40px; height: 40px;"><span class="icon-label">Email</span></div>
                    <div class="commander-icon" id="icon-adv-calculator" title="Calculator"><img src="src/assets/Images/calculator one.png" alt="Calculator" style="width: 40px; height: 40px;"><span class="icon-label">Calc</span></div>
                    <div class="commander-icon" id="icon-scratchpad" title="Scratchpad"><span class="icon-placeholder">[N]</span><span class="icon-label">Notes</span></div>
                    <div class="commander-icon" id="icon-app-suggestions" title="App Suggestions">
                        <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <img src="src/assets/Images/idea.png" alt="App Suggestions" style="width: 40px; height: 40px;">
                        </div>
                        <span class="icon-label">App Suggestions</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- COMMANDER CARD END -->

        <!-- Hidden file input (moved outside buttons) -->
        <input type="file" id="file-input" accept=".json" style="display: none;">
        <span class="sync-message" id="sync-message" role="status" style="display: block; text-align: center; margin-bottom: 10px;"></span>

        <!-- Add New Renewal Section (Modal) -->
        <div id="add-renewal-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="add-section" id="add-section">
                    <h3>Add New Renewal</h3>
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="account-name">Account Name</label>
                            <input type="text" id="account-name" required placeholder="Enter account name">
                        </div>
                        <div class="form-field">
                            <label for="renewal-date">Renewal Date</label>
                            <input type="date" id="renewal-date">
                        </div>
                        <div class="form-field">
                            <label for="sent-date">Sent Date</label>
                            <input type="date" id="sent-date">
                        </div>
                        <div class="form-field">
                            <label for="close-date">Close Date</label>
                            <input type="date" id="close-date" required>
                        </div>
                        <div class="form-field">
                            <label for="amount">Amount USD</label>
                            <input type="number" id="amount" required min="0" step="0.01" placeholder="Enter amount">
                        </div>
                        <div class="form-field">
                            <label for="opportunity-id">Opportunity ID</label>
                            <input type="text" id="opportunity-id" required placeholder="Enter Opportunity ID">
                        </div>
                    </div>
                    <div class="button-row">
                        <button class="cancel-btn">Cancel</button>
                        <button class="add-btn">Add Renewal</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmed Receipts / Progress Area (Refactored) -->
        <!-- ORIGINAL CONTAINER REMOVED AS IT'S NOW EMPTY -->
        <!-- <div class="receipts-progress"> -->
             <!-- Existing: Percentage Calculator (Class added) -->
             <!-- MOVED TO HEADER -->
        <!-- </div> -->

        <!-- Totals Toggle and Confirmed Total Area (Refactored) -->
        <div class="totals-summary">
             <!-- NEW: Combined Progress Overview Box -->
             <div id="progress-overview" class="summary-box">
                 <h3>Progress Overview</h3>
                 <!-- Main Info Texts -->
                 <p id="receipts-info">0 of 55 Receipts Received</p> <!-- Renamed from div -->
                 <div class="progress-bar-container" style="margin-bottom: 0.75rem;"> <!-- Added wrapper & margin -->
                     <div class="progress-bar">
                         <div class="progress-fill" id="receipts-progress" style="width: 0%"></div>
                     </div>
                 </div>
                 <!-- Goal Control Group -->
                 <div class="control-group goal-group"> 
                     <span id="receipts-percentage">0%</span>
                     <input type="number" id="receipts-goal-input" value="55" min="1">
                     <button id="update-goal-btn">Update Goal</button>
                 </div>
                 <hr> <!-- Separator -->
             </div>

             <!-- Renamed and Populated: Key Stats Section -->
             <div id="kpi-stats-section" class="summary-box summary-box-empty"> <!-- Renamed ID, kept classes -->
                 <h4>Key Stats</h4>
                 <div class="kpi-list">
                     <p>Total Entered: <span id="kpi-total-entered-amount" class="kpi-value">Calculating...</span></p>
                     <p>Average Confirmed: <span id="kpi-avg-amount" class="kpi-value">Calculating...</span></p>
                 </div>
             </div>

             <!-- NEW: Static text display for entry counts -->
             <!-- <p id="entry-summary-text" class="entry-summary">Loading counts...</p> -->
             <div id="total-confirmed-whole-card" class="summary-box entry-summary"> <!-- Replaced p with div and added class for styling -->
                 <h3>Total Confirmed</h3>
                 <p id="total-confirmed-whole-value" class="kpi-value">$0</p> <!-- Added kpi-value class for consistency -->
             </div>
        </div>

        <!-- SEARCH BAR: Inserted above main container -->
        <div class="search-container" role="search">
          <label for="search-input" class="visually-hidden">Search Renewals:</label>
          <input type="search" id="search-input" placeholder="Search by Name or Opp ID...">
        </div>

        <!-- Main Container for Dynamic Month Sections (Moved) -->
        <div class="container" id="main-container">
            <!-- Month sections will be dynamically loaded here by script.js -->
            
            <!-- Placeholder for elements previously in totals-breakdown if needed -->
            <div id="legacy-totals-placeholder" style="display: none;">
                <div id="total-licenses"></div>
                <div id="total-value"></div>
                <div id="accounts-goal"></div>
                <div id="accounts-progress"></div>
                <div id="accounts-percentage"></div>
                <div id="accounts-ratio"></div>
                <div id="total-accounts-input"></div>
                <button></button> <!-- Keep JS function call available -->
            </div>

            <!-- Completion status -->
            <div class="completion-status" id="completion-message" style="display: none;">
                Congratulations! You've reached your account goal for this quarter.
            </div>
        </div>

        <!-- Edit Modal (Remains at end) -->
        <div class="modal-overlay" id="edit-modal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>Edit License</h3>
                    <button class="modal-close">×</button>
                </div>
                <div class="modal-form">
                    <div class="form-field">
                        <label for="edit-name">Account Name</label>
                        <input type="text" id="edit-name" required>
                    </div>
                    <div class="form-field">
                        <label for="edit-renewal-date">Renewal Date</label>
                        <input type="date" id="edit-renewal-date">
                    </div>
                    <div class="form-field">
                        <label for="edit-sent-date">Sent Date</label>
                        <input type="date" id="edit-sent-date">
                    </div>
                    <div class="form-field">
                        <label for="edit-date">Close Date</label>
                        <input type="date" id="edit-date" required>
                    </div>
                    <div class="form-field">
                        <label for="edit-amount">Amount (USD)</label>
                        <input type="number" id="edit-amount" required min="0" step="0.01">
                    </div>
                    <div class="form-field">
                        <label for="edit-opportunity-id">Opportunity ID</label> <!-- Changed from edit-id -->
                        <input type="text" id="edit-opportunity-id" required> <!-- Changed from edit-id -->
                    </div>
                    <input type="hidden" id="edit-row-id">
                </div>
                <div class="modal-actions">
                    <button class="cancel-btn">Cancel</button>
                    <button class="add-btn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmation-modal" class="modal-overlay" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h3>Confirm Action</h3>
                </div>
                <div class="modal-content">
                    <p id="modal-message"></p>
                </div>
                <div class="modal-footer">
                    <button id="modal-cancel-btn" class="cancel-btn">Cancel</button>
                    <button id="modal-confirm-btn" class="confirm-btn">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Auto-save indicator (Remains at end) -->
        <div id="auto-save-indicator">Changes saved</div>
    </div>

    <div id="logoHoverMessageWindow" class="fancy-message-window" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="logoHoverMessageTitle">
      <div class="fancy-message-content">
        <button id="closeLogoHoverMessage" class="close-btn" aria-label="Close message">&times;</button>
        <h2 id="logoHoverMessageTitle" class="visually-hidden">A special message</h2>
        <p>Like Henry Maudslay at Bramah's locks, every craftsman's journey begins with that first crucial innovation. From shop floors to breakthrough solutions, we honor those who taught us, the places that shaped us, and the constant pursuit of better ways. Here's to the mentors who saw potential, the challenges that forged skill, and the courage to seek new horizons while keeping old friendships.</p>
        <p class="message-signature">-From a machinist's journey: Shop floor to SolidCAM, every step builds the next</p>
      </div>
    </div>
    <div id="fancyMessageOverlay" style="display:none;"></div>

    <!-- MODAL FOR GENERIC CONTENT -->
    <div id="generic-content-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="generic-modal-close-btn" class="close-button">&times;</button>
            <h3 id="generic-modal-title">Generic Modal Title</h3>
            <div id="generic-modal-body">
                <iframe id="generic-modal-iframe" src="about:blank"></iframe>
            </div>
        </div>
    </div>
    
    <!-- NEW CHAT PRO SIDEBAR -->
    <div id="chatProSidebar" class="chat-sidebar">
        <div id="chatProSidebarDragHandle" class="chat-sidebar-drag-handle"></div>
        <div class="chat-sidebar-header">
            <h3>Pro</h3>
            <button id="closeChatProSidebarBtn" class="chat-sidebar-close-btn">&times;</button>
        </div>

        <!-- Chat Pro Controls Header -->
        <div class="chat-pro-controls-header">
            <div class="model-selector-container">
                <label for="gemini-model-selector" class="visually-hidden">Gemini Model:</label>
                <select id="gemini-model-selector" aria-label="Select Gemini Model">
                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro (Latest)</option>
                    <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash (Latest)</option>
                    <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
                    <option value="gemini-2.0-flash">Gemini 2.0 Flash</option> 
                    <option value="gemini-pro">Gemini Pro</option> <!-- Kept existing Gemini Pro as it was distinct -->
                    <option value="gemini-2.5-flash-preview-04-17">Gemini 2.5 Flash Preview 04-17</option>
                    <option value="gemini-2.5-pro-experimental-03-25">Gemini 2.5 Pro Experimental 03-25</option>
                    <option value="gemini-2.0-flash-preview-image-generation">Gemini 2.0 Flash Preview Image Generation</option>
                    <option value="gemini-2.0-flash-experimental">Gemini 2.0 Flash Experimental</option>
                    <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite</option>
                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                    <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash-8B</option>
                    <option value="gemma-3">Gemma 3</option>
                    <option value="gemini-embedding-experimental-03-07">Gemini Embedding Experimental 03-07</option>
                </select>
            </div>
            <button id="chat-pro-api-settings-btn" class="button icon-button" title="API Settings">
                <i class="fas fa-key"></i> <span class="visually-hidden">API Settings</span>
            </button>
        </div>
        <!-- END: Chat Pro Controls Header -->

        <iframe id="chatProSidebarIframe" src="about:blank"></iframe>

        <!-- API Settings Modal for Chat Pro -->
        <div id="chat-pro-api-settings-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content api-settings-modal-content">
                <div class="modal-header">
                    <h4 id="chat-pro-api-modal-title">Gemini API Configuration</h4>
                    <button id="close-chat-pro-api-settings-modal-btn" class="modal-close" aria-label="Close API Settings">&times;</button>
                </div>
                <div class="modal-body api-settings-modal-body">
                    <div class="api-settings-section">
                        <h5>Credentials</h5>
                        <div class="form-field">
                            <label for="chat-pro-api-key">API Key:</label>
                            <input type="password" id="chat-pro-api-key" placeholder="Enter your Gemini API key">
                        </div>
                        <button id="chat-pro-connect-btn" class="button add-btn" style="width: 100%; margin-top: 10px;">Connect</button>
                        <div id="chat-pro-status" class="api-status" style="margin-top: 10px; text-align: center; font-size: 0.9em;">
                            Status: Not Connected
                        </div>
                    </div>

                    <div class="api-settings-section">
                        <h5>Model Parameters</h5>
                        <div class="form-field">
                            <label for="chat-pro-temperature">Temperature: 
                                <span class="default-value-display" id="default-temp-display">(Default: 0.7)</span>
                                <span class="info-icon" data-tooltip="Controls randomness. Higher values (e.g., 0.9) for more creative/random output; lower values (e.g., 0.2) for more focused/deterministic output. Use case: Creative writing (high), factual summary (low)."> <i class="fas fa-info-circle"></i></span>
                            </label>
                            <input type="range" id="chat-pro-temperature" min="0" max="1" step="0.1" value="0.7">
                            <span class="range-value">0.7</span>
                        </div>
                        <div class="form-field">
                            <label for="chat-pro-max-tokens">Max Output Tokens: 
                                <span class="default-value-display" id="default-max-tokens-display">(Default: 2048)</span>
                                <span class="info-icon" data-tooltip="Maximum number of tokens (approx. words/sub-words) the model will generate. Use case: Control response length. Shorter for quick answers, longer for detailed explanations."> <i class="fas fa-info-circle"></i></span>
                            </label>
                            <input type="number" id="chat-pro-max-tokens" value="1024" min="1">
                        </div>
                        <div class="form-field">
                            <label for="chat-pro-top-p">Top-P: 
                                <span class="default-value-display" id="default-top-p-display">(Default: 0.95)</span>
                                <span class="info-icon" data-tooltip="Nucleus sampling. Selects the smallest set of tokens whose cumulative probability exceeds P. Model samples only from this set. Use case: Alternative to Temperature for controlling randomness. 0.1 means only tokens in the top 10% probability mass are considered."> <i class="fas fa-info-circle"></i></span>
                            </label>
                            <input type="range" id="chat-pro-top-p" min="0" max="1" step="0.01" value="0.95">
                            <span class="range-value">0.95</span>
                        </div>
                        <div class="form-field">
                            <label for="chat-pro-top-k">Top-K: 
                                <span class="default-value-display" id="default-top-k-display">(Default: 40)</span>
                                <span class="info-icon" data-tooltip="Filters vocabulary to the K most probable next tokens at each step. Use case: Limits model's choices to high-probability tokens, can prevent improbable tokens. Set to 0 to disable."> <i class="fas fa-info-circle"></i></span>
                            </label>
                            <input type="number" id="chat-pro-top-k" value="40" min="1">
                        </div>
                    </div>

                    <div class="api-settings-section">
                        <h5>Safety Settings (Placeholders)</h5>
                        <div class="form-field">
                            <label>Harassment:</label>
                            <span>Block None (Placeholder)</span>
                        </div>
                        <div class="form-field">
                            <label>Hate Speech:</label>
                            <span>Block Medium and Above (Placeholder)</span>
                        </div>
                        <div class="form-field">
                            <label>Sexually Explicit:</label>
                            <span>Block Most (Placeholder)</span>
                        </div>
                         <div class="form-field">
                            <label>Dangerous Content:</label>
                            <span>Block Medium and Above (Placeholder)</span>
                        </div>
                    </div>
                    
                    <div class="api-settings-section">
                        <h5>Advanced Options</h5>
                        <p style="text-align: center; color: var(--text-secondary); font-size: 0.9em;">(Further customization options will be available here)</p>
                    </div>

                </div>
                <div class="modal-footer api-settings-modal-footer">
                    <button id="chat-pro-save-settings-btn" class="button add-btn">Save Settings</button>
                </div>
            </div>
        </div>
        <!-- END: API Settings Modal -->
    </div>

    <!-- Settings Panel Modal -->
    <div id="settings-panel-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content settings-modal-content"> <!-- Added settings-modal-content for specific styling -->
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="close-settings-panel" class="modal-close">&times;</button>
            </div>
            <div class="settings-panel-body">
                <div class="setting-item">
                    <label for="dark-mode-toggle">Dark Mode</label>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Placeholder Setting 1</label>
                    <span>(In Construction)</span>
                </div>
                <div class="setting-item">
                    <label>Placeholder Setting 2</label>
                    <span>(In Construction)</span>
                </div>
                <div class="setting-item">
                    <label>Another Placeholder</label>
                    <span>(In Construction)</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings-btn" class="add-btn">Save Settings</button>
            </div>
        </div>
    </div>
    <!-- END Settings Panel Modal -->

    <!-- App Suggestions Modal -->
    <div id="app-suggestions-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Submit an App Suggestion</h3>
                <button id="close-app-suggestions-modal-btn" class="modal-close">&times;</button>
            </div>
            <form id="app-suggestion-form">
                <div class="modal-form">
                    <div class="form-field">
                        <label for="suggestion-title">Suggestion Title</label>
                        <input type="text" id="suggestion-title" required placeholder="Brief title for your suggestion">
                    </div>
                    <div class="form-field">
                        <label for="suggestion-details">Details</label>
                        <textarea id="suggestion-details" rows="5" required placeholder="Describe your suggestion in detail..."></textarea>
                    </div>
                    <div class="form-field">
                        <label for="suggestion-priority">Priority</label>
                        <select id="suggestion-priority">
                            <option value="low">Low - Nice to have</option>
                            <option value="medium" selected>Medium - Would be helpful</option>
                            <option value="high">High - Important feature</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="suggestion-user-name">Your Name (Optional)</label>
                        <input type="text" id="suggestion-user-name" placeholder="Your name">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancel-app-suggestion-btn" class="cancel-btn">Cancel</button>
                    <button type="submit" id="send-app-suggestion-btn" class="add-btn">Send Suggestion</button>
                </div>
            </form>
        </div>
    </div>
    <!-- END App Suggestions Modal -->

    <script type="module" src="src/js/main.js"></script>
    <script src="src/js/settings.js"></script>
</body>
</html>